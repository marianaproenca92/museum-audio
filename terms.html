<!DOCTYPE html>
<html lang="pt-PT">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nó de Arquivo 12 — O Juramento</title>
  <link rel="stylesheet" href="css/intro.css">
  <link rel="stylesheet" href="css/glitch.css">
  <link rel="stylesheet" href="css/fallout-green.css">
  <style>
    #terms-body{ max-height:none !important; overflow:visible !important; }
  </style>
</head>
<body>
  <!-- Intro overlay (kept) -->
  <div id="intro" class="wrap terminal"></div>

  <!-- Main content hidden until intro finishes -->
  <main id="content" class="terminal" role="main" style="display:none">
    <div class="header">
      <span class="title glitch" data-text="PROTOCOLO">PROTOCOLO</span>
    </div>

    <!-- Sentient voice panel -->
    <section class="panel voice" aria-live="polite">
      <strong class="label">MUSEU // PROTOCOLO</strong>
      <div id="voice-terms"></div>
    </section>

    <!-- Terms body (populated via fetch; page scroll, no inner overflow) -->
    <section class="panel" id="terms-body"></section>

    <!-- Acceptance checkbox -->
    <section class="panel">
      <label>
        <input type="checkbox" id="ok"> Li e aceito as condições.
      </label>
      <div class="muted" id="gate-msg">Lê até ao fim e aceita para ouvir.</div>
    </section>

    <!-- Audio panel (hidden until unlocked) -->
    <section class="panel" id="audio-panel" style="display:none">
      <strong class="label">REPRODUÇÃO // JURAMENTO</strong>
      <audio id="museum-audio" preload="none" controls style="width:100%">
        <!-- Replace with your file path -->
        <source src="audio/juramento.mp3" type="audio/mpeg" />
        O teu navegador não suporta áudio HTML5.
      </audio>
      <small class="muted" id="audio-hint">—</small>
    </section>
  </main>

  <!-- Scripts (keep your intro) -->
  <script src="js/intro.js"></script>
  <script src="js/intro-runner.js"></script>
  <script src="js/text-glitcher.js"></script>
  <script src="js/sfx-glitch.js" defer></script>
  <script src="js/museum-voice.js" defer></script>
  <script src="js/terms-scroll-gate.js" defer></script>

  <script>
    // Start intro, then reveal main
    runIntro(() => {
      document.getElementById('content').style.display = 'block';
    });
  </script>
  <script>
    // Load external terms body (page scroll; no inner overflow)
    fetch('terms-content.html')
      .then(r => r.text())
      .then(html => {
        const host = document.getElementById('terms-body');
        host.innerHTML = html;
        // Nudge the gate to re-check height after content arrives
        document.dispatchEvent(new CustomEvent('terms:loaded'));
      })
      .catch(err => console.error('Failed to load terms', err));
  </script>
</body>
</html>